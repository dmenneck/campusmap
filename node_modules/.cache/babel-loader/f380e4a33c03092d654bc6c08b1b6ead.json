{"ast":null,"code":"'use strict';\n\nvar proj4 = require('proj4');\n\nif (proj4.default) {\n  proj4 = proj4.default;\n}\n\nvar unzip = require('./unzip');\n\nvar binaryAjax = require('./binaryajax');\n\nvar parseShp = require('./parseShp');\n\nvar parseDbf = require('parsedbf');\n\nvar Promise = require('lie');\n\nvar Cache = require('lru-cache');\n\nvar cache = new Cache({\n  max: 20\n});\n\nfunction toBuffer(b) {\n  if (!b) {\n    throw new Error('forgot to pass buffer');\n  }\n\n  if (Buffer.isBuffer(b)) {\n    return b;\n  }\n\n  if (b instanceof global.ArrayBuffer) {\n    return new Buffer(b);\n  }\n\n  if (b.buffer instanceof global.ArrayBuffer) {\n    if (b.BYTES_PER_ELEMENT === 1) {\n      return new Buffer(b);\n    }\n\n    return new Buffer(b.buffer);\n  }\n}\n\nfunction shp(base, whiteList) {\n  if (typeof base === 'string' && cache.has(base)) {\n    return Promise.resolve(cache.get(base));\n  }\n\n  return shp.getShapefile(base, whiteList).then(function (resp) {\n    if (typeof base === 'string') {\n      cache.set(base, resp);\n    }\n\n    return resp;\n  });\n}\n\nshp.combine = function (arr) {\n  var out = {};\n  out.type = 'FeatureCollection';\n  out.features = [];\n  var i = 0;\n  var len = arr[0].length;\n\n  while (i < len) {\n    out.features.push({\n      'type': 'Feature',\n      'geometry': arr[0][i],\n      'properties': arr[1][i]\n    });\n    i++;\n  }\n\n  return out;\n};\n\nshp.parseZip = function (buffer, whiteList) {\n  var key;\n  buffer = toBuffer(buffer);\n  var zip = unzip(buffer);\n  var names = [];\n  whiteList = whiteList || [];\n\n  for (key in zip) {\n    if (key.indexOf('__MACOSX') !== -1) {\n      continue;\n    }\n\n    if (key.slice(-3).toLowerCase() === 'shp') {\n      names.push(key.slice(0, -4));\n      zip[key.slice(0, -3) + key.slice(-3).toLowerCase()] = zip[key];\n    } else if (key.slice(-3).toLowerCase() === 'prj') {\n      zip[key.slice(0, -3) + key.slice(-3).toLowerCase()] = proj4(zip[key]);\n    } else if (key.slice(-4).toLowerCase() === 'json' || whiteList.indexOf(key.split('.').pop()) > -1) {\n      names.push(key.slice(0, -3) + key.slice(-3).toLowerCase());\n    } else if (key.slice(-3).toLowerCase() === 'dbf' || key.slice(-3).toLowerCase() === 'cpg') {\n      zip[key.slice(0, -3) + key.slice(-3).toLowerCase()] = zip[key];\n    }\n  }\n\n  if (!names.length) {\n    throw new Error('no layers founds');\n  }\n\n  var geojson = names.map(function (name) {\n    var parsed, dbf;\n    var lastDotIdx = name.lastIndexOf('.');\n\n    if (lastDotIdx > -1 && name.slice(lastDotIdx).indexOf('json') > -1) {\n      parsed = JSON.parse(zip[name]);\n      parsed.fileName = name.slice(0, lastDotIdx);\n    } else if (whiteList.indexOf(name.slice(lastDotIdx + 1)) > -1) {\n      parsed = zip[name];\n      parsed.fileName = name;\n    } else {\n      if (zip[name + '.dbf']) {\n        dbf = parseDbf(zip[name + '.dbf'], zip[name + '.cpg']);\n      }\n\n      parsed = shp.combine([parseShp(zip[name + '.shp'], zip[name + '.prj']), dbf]);\n      parsed.fileName = name;\n    }\n\n    return parsed;\n  });\n\n  if (geojson.length === 1) {\n    return geojson[0];\n  } else {\n    return geojson;\n  }\n};\n\nfunction getZip(base, whiteList) {\n  return binaryAjax(base).then(function (a) {\n    return shp.parseZip(a, whiteList);\n  });\n}\n\nshp.getShapefile = function (base, whiteList) {\n  if (typeof base === 'string') {\n    if (base.slice(-4).toLowerCase() === '.zip') {\n      return getZip(base, whiteList);\n    } else {\n      return Promise.all([Promise.all([binaryAjax(base + '.shp'), binaryAjax(base + '.prj')]).then(function (args) {\n        return parseShp(args[0], args[1] ? proj4(args[1]) : false);\n      }), Promise.all([binaryAjax(base + '.dbf'), binaryAjax(base + '.cpg')]).then(function (args) {\n        return parseDbf(args[0], args[1]);\n      })]).then(shp.combine);\n    }\n  } else {\n    return new Promise(function (resolve) {\n      resolve(shp.parseZip(base));\n    });\n  }\n};\n\nshp.parseShp = function (shp, prj) {\n  shp = toBuffer(shp);\n\n  if (Buffer.isBuffer(prj)) {\n    prj = prj.toString();\n  }\n\n  if (typeof prj === 'string') {\n    prj = proj4(prj);\n    return parseShp(shp, prj);\n  } else {\n    return parseShp(shp);\n  }\n};\n\nshp.parseDbf = function (dbf, cpg) {\n  dbf = toBuffer(dbf);\n  return parseDbf(dbf, cpg);\n};\n\nmodule.exports = shp;","map":{"version":3,"sources":["/Users/dirkmennecke77/Desktop/Lageplan/node_modules/shpjs/lib/index.js"],"names":["proj4","require","default","unzip","binaryAjax","parseShp","parseDbf","Promise","Cache","cache","max","toBuffer","b","Error","Buffer","isBuffer","global","ArrayBuffer","buffer","BYTES_PER_ELEMENT","shp","base","whiteList","has","resolve","get","getShapefile","then","resp","set","combine","arr","out","type","features","i","len","length","push","parseZip","key","zip","names","indexOf","slice","toLowerCase","split","pop","geojson","map","name","parsed","dbf","lastDotIdx","lastIndexOf","JSON","parse","fileName","getZip","a","all","args","prj","toString","cpg","module","exports"],"mappings":"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","sourcesContent":["'use strict';\nvar proj4 = require('proj4');\nif (proj4.default) {\n  proj4 = proj4.default;\n}\nvar unzip = require('./unzip');\nvar binaryAjax = require('./binaryajax');\nvar parseShp = require('./parseShp');\nvar parseDbf = require('parsedbf');\nvar Promise = require('lie');\nvar Cache = require('lru-cache');\nvar cache = new Cache({\n  max: 20\n});\n\nfunction toBuffer(b) {\n  if (!b) {\n    throw new Error('forgot to pass buffer');\n  }\n  if (Buffer.isBuffer(b)) {\n    return b;\n  }\n  if (b instanceof global.ArrayBuffer) {\n    return new Buffer(b);\n  }\n  if (b.buffer instanceof global.ArrayBuffer) {\n    if (b.BYTES_PER_ELEMENT === 1) {\n      return new Buffer(b);\n    }\n    return new Buffer(b.buffer);\n  }\n}\n\nfunction shp(base, whiteList) {\n  if (typeof base === 'string' && cache.has(base)) {\n    return Promise.resolve(cache.get(base));\n  }\n  return shp.getShapefile(base, whiteList).then(function(resp) {\n    if (typeof base === 'string') {\n      cache.set(base, resp);\n    }\n    return resp;\n  });\n}\nshp.combine = function(arr) {\n  var out = {};\n  out.type = 'FeatureCollection';\n  out.features = [];\n  var i = 0;\n  var len = arr[0].length;\n  while (i < len) {\n    out.features.push({\n      'type': 'Feature',\n      'geometry': arr[0][i],\n      'properties': arr[1][i]\n    });\n    i++;\n  }\n  return out;\n};\nshp.parseZip = function(buffer, whiteList) {\n  var key;\n  buffer = toBuffer(buffer);\n  var zip = unzip(buffer);\n  var names = [];\n  whiteList = whiteList || [];\n  for (key in zip) {\n    if (key.indexOf('__MACOSX') !== -1) {\n      continue;\n    }\n    if (key.slice(-3).toLowerCase() === 'shp') {\n      names.push(key.slice(0, -4));\n      zip[key.slice(0, -3) + key.slice(-3).toLowerCase()] = zip[key];\n    } else if (key.slice(-3).toLowerCase() === 'prj') {\n      zip[key.slice(0, -3) + key.slice(-3).toLowerCase()] = proj4(zip[key]);\n    } else if (key.slice(-4).toLowerCase() === 'json' || whiteList.indexOf(key.split('.').pop()) > -1) {\n      names.push(key.slice(0, -3) + key.slice(-3).toLowerCase());\n    } else if (key.slice(-3).toLowerCase() === 'dbf' || key.slice(-3).toLowerCase() === 'cpg') {\n      zip[key.slice(0, -3) + key.slice(-3).toLowerCase()] = zip[key];\n    }\n  }\n  if (!names.length) {\n    throw new Error('no layers founds');\n  }\n  var geojson = names.map(function(name) {\n    var parsed, dbf;\n    var lastDotIdx = name.lastIndexOf('.');\n    if (lastDotIdx > -1 && name.slice(lastDotIdx).indexOf('json') > -1) {\n      parsed = JSON.parse(zip[name]);\n      parsed.fileName = name.slice(0, lastDotIdx);\n    } else if (whiteList.indexOf(name.slice(lastDotIdx + 1)) > -1) {\n      parsed = zip[name];\n      parsed.fileName = name;\n    } else {\n      if (zip[name + '.dbf']) {\n        dbf = parseDbf(zip[name + '.dbf'], zip[name + '.cpg']);\n      }\n      parsed = shp.combine([parseShp(zip[name + '.shp'], zip[name + '.prj']), dbf]);\n      parsed.fileName = name;\n    }\n    return parsed;\n  });\n  if (geojson.length === 1) {\n    return geojson[0];\n  } else {\n    return geojson;\n  }\n};\n\nfunction getZip(base, whiteList) {\n  return binaryAjax(base).then(function(a) {\n    return shp.parseZip(a, whiteList);\n  });\n}\nshp.getShapefile = function(base, whiteList) {\n  if (typeof base === 'string') {\n    if (base.slice(-4).toLowerCase() === '.zip') {\n      return getZip(base, whiteList);\n    } else {\n      return Promise.all([\n        Promise.all([\n          binaryAjax(base + '.shp'),\n          binaryAjax(base + '.prj')\n        ]).then(function(args) {\n          return parseShp(args[0], args[1] ? proj4(args[1]) : false);\n        }),\n        Promise.all([\n          binaryAjax(base + '.dbf'),\n          binaryAjax(base + '.cpg')\n        ]).then(function(args) {\n          return parseDbf(args[0], args[1]);\n        })\n      ]).then(shp.combine);\n    }\n  } else {\n    return new Promise(function(resolve) {\n      resolve(shp.parseZip(base));\n    });\n  }\n};\nshp.parseShp = function(shp, prj) {\n  shp = toBuffer(shp);\n  if (Buffer.isBuffer(prj)) {\n    prj = prj.toString();\n  }\n  if (typeof prj === 'string') {\n    prj = proj4(prj);\n    return parseShp(shp, prj);\n  } else {\n    return parseShp(shp);\n  }\n};\nshp.parseDbf = function(dbf, cpg) {\n  dbf = toBuffer(dbf);\n  return parseDbf(dbf, cpg);\n};\nmodule.exports = shp;\n"]},"metadata":{},"sourceType":"script"}