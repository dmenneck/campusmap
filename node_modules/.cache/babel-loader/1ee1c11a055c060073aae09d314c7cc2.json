{"ast":null,"code":"/**\n * ag-grid-community - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components\n * @version v21.2.2\n * @link http://www.ag-grid.com/\n * @license MIT\n */\n\"use strict\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar constants_1 = require(\"../constants\");\n\nvar context_1 = require(\"../context/context\");\n\nvar gridOptionsWrapper_1 = require(\"../gridOptionsWrapper\");\n\nvar environment_1 = require(\"../environment\");\n\nvar eventService_1 = require(\"../eventService\");\n\nvar events_1 = require(\"../events\");\n\nvar utils_1 = require(\"../utils\");\n\nvar PopupService =\n/** @class */\nfunction () {\n  function PopupService() {\n    this.popupList = [];\n  }\n\n  PopupService.prototype.registerGridCore = function (gridCore) {\n    this.gridCore = gridCore;\n  };\n\n  PopupService.prototype.getDocument = function () {\n    return this.gridOptionsWrapper.getDocument();\n  };\n\n  PopupService.prototype.getPopupParent = function () {\n    var ePopupParent = this.gridOptionsWrapper.getPopupParent();\n\n    if (ePopupParent) {\n      return ePopupParent;\n    }\n\n    return this.gridCore.getRootGui();\n  };\n\n  PopupService.prototype.positionPopupForMenu = function (params) {\n    var sourceRect = params.eventSource.getBoundingClientRect();\n    var eDocument = this.getDocument();\n    var popupParent = this.getPopupParent();\n    var parentRect;\n\n    if (popupParent === eDocument.body) {\n      parentRect = eDocument.documentElement.getBoundingClientRect();\n    } else {\n      parentRect = popupParent.getBoundingClientRect();\n    }\n\n    var y = sourceRect.top - parentRect.top;\n    y = this.keepYWithinBounds(params, y);\n    var minWidth = params.ePopup.clientWidth > 0 ? params.ePopup.clientWidth : 200;\n    params.ePopup.style.minWidth = minWidth + \"px\";\n    var widthOfParent = parentRect.right - parentRect.left;\n    var maxX = widthOfParent - minWidth; // the x position of the popup depends on RTL or LTR. for normal cases, LTR, we put the child popup\n    // to the right, unless it doesn't fit and we then put it to the left. for RTL it's the other way around,\n    // we try place it first to the left, and then if not to the right.\n\n    var x;\n\n    if (this.gridOptionsWrapper.isEnableRtl()) {\n      // for RTL, try left first\n      x = xLeftPosition();\n\n      if (x < 0) {\n        x = xRightPosition();\n      }\n\n      if (x > maxX) {\n        x = 0;\n      }\n    } else {\n      // for LTR, try right first\n      x = xRightPosition();\n\n      if (x > maxX) {\n        x = xLeftPosition();\n      }\n\n      if (x < 0) {\n        x = 0;\n      }\n    }\n\n    params.ePopup.style.left = x + \"px\";\n    params.ePopup.style.top = y + \"px\";\n\n    function xRightPosition() {\n      return sourceRect.right - parentRect.left - 2;\n    }\n\n    function xLeftPosition() {\n      return sourceRect.left - parentRect.left - minWidth;\n    }\n  };\n\n  PopupService.prototype.positionPopupUnderMouseEvent = function (params) {\n    var _a = this.calculatePointerAlign(params.mouseEvent),\n        x = _a.x,\n        y = _a.y;\n\n    var ePopup = params.ePopup,\n        nudgeX = params.nudgeX,\n        nudgeY = params.nudgeY;\n    this.positionPopup({\n      ePopup: ePopup,\n      x: x,\n      y: y,\n      nudgeX: nudgeX,\n      nudgeY: nudgeY,\n      keepWithinBounds: true\n    });\n    this.callPostProcessPopup(params.ePopup, null, params.mouseEvent, params.type, params.column, params.rowNode);\n  };\n\n  PopupService.prototype.calculatePointerAlign = function (e) {\n    var eDocument = this.getDocument();\n    var popupParent = this.getPopupParent();\n    var parentRect = popupParent.getBoundingClientRect();\n    var documentRect = eDocument.documentElement.getBoundingClientRect();\n    return {\n      x: e.clientX - (popupParent === eDocument.body ? documentRect.left : parentRect.left),\n      y: e.clientY - (popupParent === eDocument.body ? documentRect.top : parentRect.top)\n    };\n  };\n\n  PopupService.prototype.positionPopupUnderComponent = function (params) {\n    var sourceRect = params.eventSource.getBoundingClientRect();\n    var eDocument = this.getDocument();\n    var popupParent = this.getPopupParent();\n    var alignSide = params.alignSide || 'left';\n    var parentRect;\n\n    if (popupParent === eDocument.body) {\n      parentRect = eDocument.documentElement.getBoundingClientRect();\n    } else {\n      parentRect = popupParent.getBoundingClientRect();\n    }\n\n    var x = sourceRect.left - parentRect.left;\n\n    if (alignSide === 'right') {\n      x -= params.ePopup.offsetWidth - sourceRect.width;\n    }\n\n    this.positionPopup({\n      ePopup: params.ePopup,\n      minWidth: params.minWidth,\n      minHeight: params.minHeight,\n      nudgeX: params.nudgeX,\n      nudgeY: params.nudgeY,\n      x: x,\n      y: sourceRect.top - parentRect.top + sourceRect.height,\n      keepWithinBounds: params.keepWithinBounds\n    });\n    this.callPostProcessPopup(params.ePopup, params.eventSource, null, params.type, params.column, params.rowNode);\n  };\n\n  PopupService.prototype.positionPopupOverComponent = function (params) {\n    var sourceRect = params.eventSource.getBoundingClientRect();\n    var eDocument = this.getDocument();\n    var popupParent = this.getPopupParent();\n    var parentRect;\n\n    if (popupParent === eDocument.body) {\n      parentRect = eDocument.documentElement.getBoundingClientRect();\n    } else {\n      parentRect = popupParent.getBoundingClientRect();\n    }\n\n    this.positionPopup({\n      ePopup: params.ePopup,\n      minWidth: params.minWidth,\n      nudgeX: params.nudgeX,\n      nudgeY: params.nudgeY,\n      x: sourceRect.left - parentRect.left,\n      y: sourceRect.top - parentRect.top,\n      keepWithinBounds: params.keepWithinBounds\n    });\n    this.callPostProcessPopup(params.ePopup, params.eventSource, null, params.type, params.column, params.rowNode);\n  };\n\n  PopupService.prototype.callPostProcessPopup = function (ePopup, eventSource, mouseEvent, type, column, rowNode) {\n    var callback = this.gridOptionsWrapper.getPostProcessPopupFunc();\n\n    if (callback) {\n      var params = {\n        column: column,\n        rowNode: rowNode,\n        ePopup: ePopup,\n        type: type,\n        eventSource: eventSource,\n        mouseEvent: mouseEvent\n      };\n      callback(params);\n    }\n  };\n\n  PopupService.prototype.positionPopup = function (params) {\n    var x = params.x;\n    var y = params.y;\n\n    if (params.nudgeX) {\n      x += params.nudgeX;\n    }\n\n    if (params.nudgeY) {\n      y += params.nudgeY;\n    } // if popup is overflowing to the bottom, move it up\n\n\n    if (params.keepWithinBounds) {\n      x = this.keepXWithinBounds(params, x);\n      y = this.keepYWithinBounds(params, y);\n    }\n\n    params.ePopup.style.left = x + \"px\";\n    params.ePopup.style.top = y + \"px\";\n  };\n\n  PopupService.prototype.keepYWithinBounds = function (params, y) {\n    var eDocument = this.gridOptionsWrapper.getDocument();\n    var docElement = eDocument.documentElement;\n    var popupParent = this.getPopupParent();\n    var parentRect = popupParent.getBoundingClientRect();\n    var documentRect = eDocument.documentElement.getBoundingClientRect();\n    var isBody = popupParent === eDocument.body;\n    var defaultPadding = 3;\n    var minHeight = Math.min(200, parentRect.height);\n    var diff = 0;\n\n    if (params.minHeight && params.minHeight < minHeight) {\n      minHeight = params.minHeight;\n    } else if (params.ePopup.offsetHeight > 0) {\n      minHeight = params.ePopup.clientHeight;\n      diff = utils_1._.getAbsoluteHeight(params.ePopup) - minHeight;\n    }\n\n    var heightOfParent = isBody ? utils_1._.getAbsoluteHeight(docElement) + docElement.scrollTop : parentRect.height;\n\n    if (isBody) {\n      heightOfParent -= Math.abs(documentRect.top - parentRect.top);\n    }\n\n    var maxY = heightOfParent - minHeight - diff - defaultPadding;\n    return Math.min(Math.max(y, 0), Math.abs(maxY));\n  };\n\n  PopupService.prototype.keepXWithinBounds = function (params, x) {\n    var eDocument = this.gridOptionsWrapper.getDocument();\n    var docElement = eDocument.documentElement;\n    var popupParent = this.getPopupParent();\n    var parentRect = popupParent.getBoundingClientRect();\n    var documentRect = eDocument.documentElement.getBoundingClientRect();\n    var isBody = popupParent === eDocument.body;\n    var defaultPadding = 3;\n    var ePopup = params.ePopup;\n    var minWidth = Math.min(200, parentRect.width);\n    var diff = 0;\n\n    if (params.minWidth && params.minWidth < minWidth) {\n      minWidth = params.minWidth;\n    } else if (ePopup.offsetWidth > 0) {\n      minWidth = ePopup.offsetWidth;\n      ePopup.style.minWidth = minWidth + \"px\";\n      diff = utils_1._.getAbsoluteWidth(ePopup) - minWidth;\n    }\n\n    var widthOfParent = isBody ? utils_1._.getAbsoluteWidth(docElement) + docElement.scrollLeft : parentRect.width;\n\n    if (isBody) {\n      widthOfParent -= Math.abs(documentRect.left - parentRect.left);\n    }\n\n    var maxX = widthOfParent - minWidth - diff - defaultPadding;\n    return Math.min(Math.max(x, 0), Math.abs(maxX));\n  }; // adds an element to a div, but also listens to background checking for clicks,\n  // so that when the background is clicked, the child is removed again, giving\n  // a model look to popups.\n\n\n  PopupService.prototype.addAsModalPopup = function (eChild, closeOnEsc, closedCallback, click) {\n    return this.addPopup(true, eChild, closeOnEsc, closedCallback, click);\n  };\n\n  PopupService.prototype.addPopup = function (modal, eChild, closeOnEsc, closedCallback, click, alwaysOnTop) {\n    var _this = this;\n\n    var eDocument = this.gridOptionsWrapper.getDocument();\n\n    if (!eDocument) {\n      console.warn('ag-grid: could not find the document, document is empty');\n      return function () {};\n    }\n\n    var pos = utils_1._.findIndex(this.popupList, function (popup) {\n      return popup.element === eChild;\n    });\n\n    if (pos !== -1) {\n      var popup = this.popupList[pos];\n      return popup.hideFunc;\n    }\n\n    var ePopupParent = this.getPopupParent(); // for angular specifically, but shouldn't cause an issue with js or other fw's\n    // https://github.com/angular/angular/issues/8563\n\n    ePopupParent.appendChild(eChild);\n    eChild.style.top = '0px';\n    eChild.style.left = '0px'; // add env CSS class to child, in case user provided a popup parent, which means\n    // theme class may be missing\n\n    var eWrapper = document.createElement('div');\n    var theme = this.environment.getTheme().theme;\n\n    if (theme) {\n      utils_1._.addCssClass(eWrapper, theme);\n    }\n\n    utils_1._.addCssClass(eWrapper, 'ag-popup');\n\n    utils_1._.addCssClass(eChild, this.gridOptionsWrapper.isEnableRtl() ? 'ag-rtl' : 'ag-ltr');\n\n    eWrapper.appendChild(eChild);\n    ePopupParent.appendChild(eWrapper);\n\n    if (alwaysOnTop) {\n      this.setAlwaysOnTop(eWrapper, true);\n    } else {\n      this.bringPopupToFront(eWrapper);\n    }\n\n    var popupHidden = false;\n\n    var hidePopupOnKeyboardEvent = function (event) {\n      var key = event.which || event.keyCode;\n\n      if (key === constants_1.Constants.KEY_ESCAPE && eWrapper.contains(document.activeElement)) {\n        hidePopup(null);\n      }\n    };\n\n    var hidePopupOnMouseEvent = function (event) {\n      hidePopup(event);\n    };\n\n    var hidePopupOnTouchEvent = function (event) {\n      hidePopup(null, event);\n    };\n\n    var hidePopup = function (mouseEvent, touchEvent) {\n      if ( // we don't hide popup if the event was on the child, or any\n      // children of this child\n      _this.isEventFromCurrentPopup(mouseEvent, touchEvent, eChild) || // if the event to close is actually the open event, then ignore it\n      _this.isEventSameChainAsOriginalEvent(click, mouseEvent, touchEvent) || // this method should only be called once. the client can have different\n      // paths, each one wanting to close, so this method may be called multiple times.\n      popupHidden) {\n        return;\n      }\n\n      popupHidden = true;\n      ePopupParent.removeChild(eWrapper);\n      eDocument.removeEventListener('keydown', hidePopupOnKeyboardEvent);\n      eDocument.removeEventListener('mousedown', hidePopupOnMouseEvent);\n      eDocument.removeEventListener('touchstart', hidePopupOnTouchEvent);\n      eDocument.removeEventListener('contextmenu', hidePopupOnMouseEvent);\n\n      _this.eventService.removeEventListener(events_1.Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n\n      if (closedCallback) {\n        closedCallback();\n      }\n\n      _this.popupList = _this.popupList.filter(function (popup) {\n        return popup.element !== eChild;\n      });\n    }; // if we add these listeners now, then the current mouse\n    // click will be included, which we don't want\n\n\n    window.setTimeout(function () {\n      if (closeOnEsc) {\n        eDocument.addEventListener('keydown', hidePopupOnKeyboardEvent);\n      }\n\n      if (modal) {\n        eDocument.addEventListener('mousedown', hidePopupOnMouseEvent);\n\n        _this.eventService.addEventListener(events_1.Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n\n        eDocument.addEventListener('touchstart', hidePopupOnTouchEvent);\n        eDocument.addEventListener('contextmenu', hidePopupOnMouseEvent);\n      }\n    }, 0);\n    this.popupList.push({\n      element: eChild,\n      hideFunc: hidePopup\n    });\n    return hidePopup;\n  };\n\n  PopupService.prototype.isEventFromCurrentPopup = function (mouseEvent, touchEvent, eChild) {\n    var event = mouseEvent ? mouseEvent : touchEvent;\n\n    if (!event) {\n      return false;\n    }\n\n    var indexOfThisChild = utils_1._.findIndex(this.popupList, function (popup) {\n      return popup.element === eChild;\n    });\n\n    if (indexOfThisChild === -1) {\n      return false;\n    }\n\n    for (var i = indexOfThisChild; i < this.popupList.length; i++) {\n      var popup = this.popupList[i];\n\n      if (utils_1._.isElementInEventPath(popup.element, event)) {\n        return true;\n      }\n    } // if the user did not write their own Custom Element to be rendered as popup\n    // and this component has additional popup element, they should have the\n    // `ag-custom-component-popup` class to be detected as part of the Custom Component\n\n\n    var el = event.target;\n\n    while (el && el != document.body) {\n      if (el.classList.contains('ag-custom-component-popup') || el.parentElement === null) {\n        return true;\n      }\n\n      el = el.parentElement;\n    }\n  }; // in some browsers, the context menu event can be fired before the click event, which means\n  // the context menu event could open the popup, but then the click event closes it straight away.\n\n\n  PopupService.prototype.isEventSameChainAsOriginalEvent = function (originalClick, mouseEvent, touchEvent) {\n    // we check the coordinates of the event, to see if it's the same event. there is a 1 / 1000 chance that\n    // the event is a different event, however that is an edge case that is not very relevant (the user clicking\n    // twice on the same location isn't a normal path).\n    // event could be mouse event or touch event.\n    var mouseEventOrTouch = null;\n\n    if (mouseEvent) {\n      // mouse event can be used direction, it has coordinates\n      mouseEventOrTouch = mouseEvent;\n    } else if (touchEvent) {\n      // touch event doesn't have coordinates, need it's touch object\n      mouseEventOrTouch = touchEvent.touches[0];\n    }\n\n    if (mouseEventOrTouch && originalClick) {\n      // for x, allow 4px margin, to cover iPads, where touch (which opens menu) is followed\n      // by browser click (when you life finger up, touch is interrupted as click in browser)\n      var screenX_1 = mouseEvent ? mouseEvent.screenX : 0;\n      var screenY_1 = mouseEvent ? mouseEvent.screenY : 0;\n      var xMatch = Math.abs(originalClick.screenX - screenX_1) < 5;\n      var yMatch = Math.abs(originalClick.screenY - screenY_1) < 5;\n\n      if (xMatch && yMatch) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  PopupService.prototype.getWrapper = function (ePopup) {\n    while (!utils_1._.containsClass(ePopup, 'ag-popup') && ePopup.parentElement) {\n      ePopup = ePopup.parentElement;\n    }\n\n    return utils_1._.containsClass(ePopup, 'ag-popup') ? ePopup : null;\n  };\n\n  PopupService.prototype.setAlwaysOnTop = function (ePopup, alwaysOnTop) {\n    var eWrapper = this.getWrapper(ePopup);\n\n    if (!eWrapper) {\n      return;\n    }\n\n    utils_1._.addOrRemoveCssClass(eWrapper, 'ag-always-on-top', !!alwaysOnTop);\n\n    if (alwaysOnTop) {\n      this.bringPopupToFront(eWrapper);\n    }\n  };\n\n  PopupService.prototype.bringPopupToFront = function (ePopup) {\n    var parent = this.getPopupParent();\n    var popupList = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup'));\n    var popupLen = popupList.length;\n    var alwaysOnTopList = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup.ag-always-on-top'));\n    var onTopLength = alwaysOnTopList.length;\n    var eWrapper = this.getWrapper(ePopup);\n\n    if (!eWrapper || popupLen <= 1 || !parent.contains(ePopup)) {\n      return;\n    }\n\n    var pos = popupList.indexOf(eWrapper);\n\n    if (onTopLength) {\n      var isPopupAlwaysOnTop = utils_1._.containsClass(eWrapper, 'ag-always-on-top');\n\n      if (isPopupAlwaysOnTop) {\n        if (pos !== popupLen - 1) {\n          utils_1._.last(alwaysOnTopList).insertAdjacentElement('afterend', eWrapper);\n        }\n      } else if (pos !== popupLen - onTopLength - 1) {\n        alwaysOnTopList[0].insertAdjacentElement('beforebegin', eWrapper);\n      }\n    } else if (pos !== popupLen - 1) {\n      utils_1._.last(popupList).insertAdjacentElement('afterend', eWrapper);\n    }\n\n    var params = {\n      type: 'popupToFront',\n      api: this.gridOptionsWrapper.getApi(),\n      columnApi: this.gridOptionsWrapper.getColumnApi(),\n      eWrapper: eWrapper\n    };\n    this.eventService.dispatchEvent(params);\n  };\n\n  __decorate([context_1.Autowired('gridOptionsWrapper'), __metadata(\"design:type\", gridOptionsWrapper_1.GridOptionsWrapper)], PopupService.prototype, \"gridOptionsWrapper\", void 0);\n\n  __decorate([context_1.Autowired('environment'), __metadata(\"design:type\", environment_1.Environment)], PopupService.prototype, \"environment\", void 0);\n\n  __decorate([context_1.Autowired('eventService'), __metadata(\"design:type\", eventService_1.EventService)], PopupService.prototype, \"eventService\", void 0);\n\n  PopupService = __decorate([context_1.Bean('popupService')], PopupService);\n  return PopupService;\n}();\n\nexports.PopupService = PopupService;","map":{"version":3,"sources":["/Users/dirkmennecke77/Desktop/Lageplan/node_modules/ag-grid-community/dist/lib/widgets/popupService.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__metadata","k","v","metadata","exports","value","constants_1","require","context_1","gridOptionsWrapper_1","environment_1","eventService_1","events_1","utils_1","PopupService","popupList","prototype","registerGridCore","gridCore","getDocument","gridOptionsWrapper","getPopupParent","ePopupParent","getRootGui","positionPopupForMenu","params","sourceRect","eventSource","getBoundingClientRect","eDocument","popupParent","parentRect","body","documentElement","y","top","keepYWithinBounds","minWidth","ePopup","clientWidth","style","widthOfParent","right","left","maxX","x","isEnableRtl","xLeftPosition","xRightPosition","positionPopupUnderMouseEvent","_a","calculatePointerAlign","mouseEvent","nudgeX","nudgeY","positionPopup","keepWithinBounds","callPostProcessPopup","type","column","rowNode","e","documentRect","clientX","clientY","positionPopupUnderComponent","alignSide","offsetWidth","width","minHeight","height","positionPopupOverComponent","callback","getPostProcessPopupFunc","keepXWithinBounds","docElement","isBody","defaultPadding","Math","min","diff","offsetHeight","clientHeight","_","getAbsoluteHeight","heightOfParent","scrollTop","abs","maxY","max","getAbsoluteWidth","scrollLeft","addAsModalPopup","eChild","closeOnEsc","closedCallback","click","addPopup","modal","alwaysOnTop","_this","console","warn","pos","findIndex","popup","element","hideFunc","appendChild","eWrapper","document","createElement","theme","environment","getTheme","addCssClass","setAlwaysOnTop","bringPopupToFront","popupHidden","hidePopupOnKeyboardEvent","event","which","keyCode","Constants","KEY_ESCAPE","contains","activeElement","hidePopup","hidePopupOnMouseEvent","hidePopupOnTouchEvent","touchEvent","isEventFromCurrentPopup","isEventSameChainAsOriginalEvent","removeChild","removeEventListener","eventService","Events","EVENT_DRAG_STARTED","filter","window","setTimeout","addEventListener","push","indexOfThisChild","isElementInEventPath","el","classList","parentElement","originalClick","mouseEventOrTouch","touches","screenX_1","screenX","screenY_1","screenY","xMatch","yMatch","getWrapper","containsClass","addOrRemoveCssClass","parent","Array","slice","call","querySelectorAll","popupLen","alwaysOnTopList","onTopLength","indexOf","isPopupAlwaysOnTop","last","insertAdjacentElement","api","getApi","columnApi","getColumnApi","dispatchEvent","Autowired","GridOptionsWrapper","Environment","EventService","Bean"],"mappings":"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","sourcesContent":["/**\n * ag-grid-community - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components\n * @version v21.2.2\n * @link http://www.ag-grid.com/\n * @license MIT\n */\n\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar constants_1 = require(\"../constants\");\nvar context_1 = require(\"../context/context\");\nvar gridOptionsWrapper_1 = require(\"../gridOptionsWrapper\");\nvar environment_1 = require(\"../environment\");\nvar eventService_1 = require(\"../eventService\");\nvar events_1 = require(\"../events\");\nvar utils_1 = require(\"../utils\");\nvar PopupService = /** @class */ (function () {\n    function PopupService() {\n        this.popupList = [];\n    }\n    PopupService.prototype.registerGridCore = function (gridCore) {\n        this.gridCore = gridCore;\n    };\n    PopupService.prototype.getDocument = function () {\n        return this.gridOptionsWrapper.getDocument();\n    };\n    PopupService.prototype.getPopupParent = function () {\n        var ePopupParent = this.gridOptionsWrapper.getPopupParent();\n        if (ePopupParent) {\n            return ePopupParent;\n        }\n        return this.gridCore.getRootGui();\n    };\n    PopupService.prototype.positionPopupForMenu = function (params) {\n        var sourceRect = params.eventSource.getBoundingClientRect();\n        var eDocument = this.getDocument();\n        var popupParent = this.getPopupParent();\n        var parentRect;\n        if (popupParent === eDocument.body) {\n            parentRect = eDocument.documentElement.getBoundingClientRect();\n        }\n        else {\n            parentRect = popupParent.getBoundingClientRect();\n        }\n        var y = sourceRect.top - parentRect.top;\n        y = this.keepYWithinBounds(params, y);\n        var minWidth = (params.ePopup.clientWidth > 0) ? params.ePopup.clientWidth : 200;\n        params.ePopup.style.minWidth = minWidth + \"px\";\n        var widthOfParent = parentRect.right - parentRect.left;\n        var maxX = widthOfParent - minWidth;\n        // the x position of the popup depends on RTL or LTR. for normal cases, LTR, we put the child popup\n        // to the right, unless it doesn't fit and we then put it to the left. for RTL it's the other way around,\n        // we try place it first to the left, and then if not to the right.\n        var x;\n        if (this.gridOptionsWrapper.isEnableRtl()) {\n            // for RTL, try left first\n            x = xLeftPosition();\n            if (x < 0) {\n                x = xRightPosition();\n            }\n            if (x > maxX) {\n                x = 0;\n            }\n        }\n        else {\n            // for LTR, try right first\n            x = xRightPosition();\n            if (x > maxX) {\n                x = xLeftPosition();\n            }\n            if (x < 0) {\n                x = 0;\n            }\n        }\n        params.ePopup.style.left = x + \"px\";\n        params.ePopup.style.top = y + \"px\";\n        function xRightPosition() {\n            return sourceRect.right - parentRect.left - 2;\n        }\n        function xLeftPosition() {\n            return sourceRect.left - parentRect.left - minWidth;\n        }\n    };\n    PopupService.prototype.positionPopupUnderMouseEvent = function (params) {\n        var _a = this.calculatePointerAlign(params.mouseEvent), x = _a.x, y = _a.y;\n        var ePopup = params.ePopup, nudgeX = params.nudgeX, nudgeY = params.nudgeY;\n        this.positionPopup({\n            ePopup: ePopup,\n            x: x,\n            y: y,\n            nudgeX: nudgeX,\n            nudgeY: nudgeY,\n            keepWithinBounds: true\n        });\n        this.callPostProcessPopup(params.ePopup, null, params.mouseEvent, params.type, params.column, params.rowNode);\n    };\n    PopupService.prototype.calculatePointerAlign = function (e) {\n        var eDocument = this.getDocument();\n        var popupParent = this.getPopupParent();\n        var parentRect = popupParent.getBoundingClientRect();\n        var documentRect = eDocument.documentElement.getBoundingClientRect();\n        return {\n            x: e.clientX - (popupParent === eDocument.body ? documentRect.left : parentRect.left),\n            y: e.clientY - (popupParent === eDocument.body ? documentRect.top : parentRect.top)\n        };\n    };\n    PopupService.prototype.positionPopupUnderComponent = function (params) {\n        var sourceRect = params.eventSource.getBoundingClientRect();\n        var eDocument = this.getDocument();\n        var popupParent = this.getPopupParent();\n        var alignSide = params.alignSide || 'left';\n        var parentRect;\n        if (popupParent === eDocument.body) {\n            parentRect = eDocument.documentElement.getBoundingClientRect();\n        }\n        else {\n            parentRect = popupParent.getBoundingClientRect();\n        }\n        var x = sourceRect.left - parentRect.left;\n        if (alignSide === 'right') {\n            x -= (params.ePopup.offsetWidth - sourceRect.width);\n        }\n        this.positionPopup({\n            ePopup: params.ePopup,\n            minWidth: params.minWidth,\n            minHeight: params.minHeight,\n            nudgeX: params.nudgeX,\n            nudgeY: params.nudgeY,\n            x: x,\n            y: sourceRect.top - parentRect.top + sourceRect.height,\n            keepWithinBounds: params.keepWithinBounds\n        });\n        this.callPostProcessPopup(params.ePopup, params.eventSource, null, params.type, params.column, params.rowNode);\n    };\n    PopupService.prototype.positionPopupOverComponent = function (params) {\n        var sourceRect = params.eventSource.getBoundingClientRect();\n        var eDocument = this.getDocument();\n        var popupParent = this.getPopupParent();\n        var parentRect;\n        if (popupParent === eDocument.body) {\n            parentRect = eDocument.documentElement.getBoundingClientRect();\n        }\n        else {\n            parentRect = popupParent.getBoundingClientRect();\n        }\n        this.positionPopup({\n            ePopup: params.ePopup,\n            minWidth: params.minWidth,\n            nudgeX: params.nudgeX,\n            nudgeY: params.nudgeY,\n            x: sourceRect.left - parentRect.left,\n            y: sourceRect.top - parentRect.top,\n            keepWithinBounds: params.keepWithinBounds\n        });\n        this.callPostProcessPopup(params.ePopup, params.eventSource, null, params.type, params.column, params.rowNode);\n    };\n    PopupService.prototype.callPostProcessPopup = function (ePopup, eventSource, mouseEvent, type, column, rowNode) {\n        var callback = this.gridOptionsWrapper.getPostProcessPopupFunc();\n        if (callback) {\n            var params = {\n                column: column,\n                rowNode: rowNode,\n                ePopup: ePopup,\n                type: type,\n                eventSource: eventSource,\n                mouseEvent: mouseEvent\n            };\n            callback(params);\n        }\n    };\n    PopupService.prototype.positionPopup = function (params) {\n        var x = params.x;\n        var y = params.y;\n        if (params.nudgeX) {\n            x += params.nudgeX;\n        }\n        if (params.nudgeY) {\n            y += params.nudgeY;\n        }\n        // if popup is overflowing to the bottom, move it up\n        if (params.keepWithinBounds) {\n            x = this.keepXWithinBounds(params, x);\n            y = this.keepYWithinBounds(params, y);\n        }\n        params.ePopup.style.left = x + \"px\";\n        params.ePopup.style.top = y + \"px\";\n    };\n    PopupService.prototype.keepYWithinBounds = function (params, y) {\n        var eDocument = this.gridOptionsWrapper.getDocument();\n        var docElement = eDocument.documentElement;\n        var popupParent = this.getPopupParent();\n        var parentRect = popupParent.getBoundingClientRect();\n        var documentRect = eDocument.documentElement.getBoundingClientRect();\n        var isBody = popupParent === eDocument.body;\n        var defaultPadding = 3;\n        var minHeight = Math.min(200, parentRect.height);\n        var diff = 0;\n        if (params.minHeight && params.minHeight < minHeight) {\n            minHeight = params.minHeight;\n        }\n        else if (params.ePopup.offsetHeight > 0) {\n            minHeight = params.ePopup.clientHeight;\n            diff = utils_1._.getAbsoluteHeight(params.ePopup) - minHeight;\n        }\n        var heightOfParent = isBody ? (utils_1._.getAbsoluteHeight(docElement) + docElement.scrollTop) : parentRect.height;\n        if (isBody) {\n            heightOfParent -= Math.abs(documentRect.top - parentRect.top);\n        }\n        var maxY = heightOfParent - minHeight - diff - defaultPadding;\n        return Math.min(Math.max(y, 0), Math.abs(maxY));\n    };\n    PopupService.prototype.keepXWithinBounds = function (params, x) {\n        var eDocument = this.gridOptionsWrapper.getDocument();\n        var docElement = eDocument.documentElement;\n        var popupParent = this.getPopupParent();\n        var parentRect = popupParent.getBoundingClientRect();\n        var documentRect = eDocument.documentElement.getBoundingClientRect();\n        var isBody = popupParent === eDocument.body;\n        var defaultPadding = 3;\n        var ePopup = params.ePopup;\n        var minWidth = Math.min(200, parentRect.width);\n        var diff = 0;\n        if (params.minWidth && params.minWidth < minWidth) {\n            minWidth = params.minWidth;\n        }\n        else if (ePopup.offsetWidth > 0) {\n            minWidth = ePopup.offsetWidth;\n            ePopup.style.minWidth = minWidth + \"px\";\n            diff = utils_1._.getAbsoluteWidth(ePopup) - minWidth;\n        }\n        var widthOfParent = isBody ? (utils_1._.getAbsoluteWidth(docElement) + docElement.scrollLeft) : parentRect.width;\n        if (isBody) {\n            widthOfParent -= Math.abs(documentRect.left - parentRect.left);\n        }\n        var maxX = widthOfParent - minWidth - diff - defaultPadding;\n        return Math.min(Math.max(x, 0), Math.abs(maxX));\n    };\n    // adds an element to a div, but also listens to background checking for clicks,\n    // so that when the background is clicked, the child is removed again, giving\n    // a model look to popups.\n    PopupService.prototype.addAsModalPopup = function (eChild, closeOnEsc, closedCallback, click) {\n        return this.addPopup(true, eChild, closeOnEsc, closedCallback, click);\n    };\n    PopupService.prototype.addPopup = function (modal, eChild, closeOnEsc, closedCallback, click, alwaysOnTop) {\n        var _this = this;\n        var eDocument = this.gridOptionsWrapper.getDocument();\n        if (!eDocument) {\n            console.warn('ag-grid: could not find the document, document is empty');\n            return function () { };\n        }\n        var pos = utils_1._.findIndex(this.popupList, function (popup) { return popup.element === eChild; });\n        if (pos !== -1) {\n            var popup = this.popupList[pos];\n            return popup.hideFunc;\n        }\n        var ePopupParent = this.getPopupParent();\n        // for angular specifically, but shouldn't cause an issue with js or other fw's\n        // https://github.com/angular/angular/issues/8563\n        ePopupParent.appendChild(eChild);\n        eChild.style.top = '0px';\n        eChild.style.left = '0px';\n        // add env CSS class to child, in case user provided a popup parent, which means\n        // theme class may be missing\n        var eWrapper = document.createElement('div');\n        var theme = this.environment.getTheme().theme;\n        if (theme) {\n            utils_1._.addCssClass(eWrapper, theme);\n        }\n        utils_1._.addCssClass(eWrapper, 'ag-popup');\n        utils_1._.addCssClass(eChild, this.gridOptionsWrapper.isEnableRtl() ? 'ag-rtl' : 'ag-ltr');\n        eWrapper.appendChild(eChild);\n        ePopupParent.appendChild(eWrapper);\n        if (alwaysOnTop) {\n            this.setAlwaysOnTop(eWrapper, true);\n        }\n        else {\n            this.bringPopupToFront(eWrapper);\n        }\n        var popupHidden = false;\n        var hidePopupOnKeyboardEvent = function (event) {\n            var key = event.which || event.keyCode;\n            if (key === constants_1.Constants.KEY_ESCAPE && eWrapper.contains(document.activeElement)) {\n                hidePopup(null);\n            }\n        };\n        var hidePopupOnMouseEvent = function (event) {\n            hidePopup(event);\n        };\n        var hidePopupOnTouchEvent = function (event) {\n            hidePopup(null, event);\n        };\n        var hidePopup = function (mouseEvent, touchEvent) {\n            if (\n            // we don't hide popup if the event was on the child, or any\n            // children of this child\n            _this.isEventFromCurrentPopup(mouseEvent, touchEvent, eChild) ||\n                // if the event to close is actually the open event, then ignore it\n                _this.isEventSameChainAsOriginalEvent(click, mouseEvent, touchEvent) ||\n                // this method should only be called once. the client can have different\n                // paths, each one wanting to close, so this method may be called multiple times.\n                popupHidden) {\n                return;\n            }\n            popupHidden = true;\n            ePopupParent.removeChild(eWrapper);\n            eDocument.removeEventListener('keydown', hidePopupOnKeyboardEvent);\n            eDocument.removeEventListener('mousedown', hidePopupOnMouseEvent);\n            eDocument.removeEventListener('touchstart', hidePopupOnTouchEvent);\n            eDocument.removeEventListener('contextmenu', hidePopupOnMouseEvent);\n            _this.eventService.removeEventListener(events_1.Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n            if (closedCallback) {\n                closedCallback();\n            }\n            _this.popupList = _this.popupList.filter(function (popup) { return popup.element !== eChild; });\n        };\n        // if we add these listeners now, then the current mouse\n        // click will be included, which we don't want\n        window.setTimeout(function () {\n            if (closeOnEsc) {\n                eDocument.addEventListener('keydown', hidePopupOnKeyboardEvent);\n            }\n            if (modal) {\n                eDocument.addEventListener('mousedown', hidePopupOnMouseEvent);\n                _this.eventService.addEventListener(events_1.Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n                eDocument.addEventListener('touchstart', hidePopupOnTouchEvent);\n                eDocument.addEventListener('contextmenu', hidePopupOnMouseEvent);\n            }\n        }, 0);\n        this.popupList.push({\n            element: eChild,\n            hideFunc: hidePopup\n        });\n        return hidePopup;\n    };\n    PopupService.prototype.isEventFromCurrentPopup = function (mouseEvent, touchEvent, eChild) {\n        var event = mouseEvent ? mouseEvent : touchEvent;\n        if (!event) {\n            return false;\n        }\n        var indexOfThisChild = utils_1._.findIndex(this.popupList, function (popup) { return popup.element === eChild; });\n        if (indexOfThisChild === -1) {\n            return false;\n        }\n        for (var i = indexOfThisChild; i < this.popupList.length; i++) {\n            var popup = this.popupList[i];\n            if (utils_1._.isElementInEventPath(popup.element, event)) {\n                return true;\n            }\n        }\n        // if the user did not write their own Custom Element to be rendered as popup\n        // and this component has additional popup element, they should have the\n        // `ag-custom-component-popup` class to be detected as part of the Custom Component\n        var el = event.target;\n        while (el && el != document.body) {\n            if (el.classList.contains('ag-custom-component-popup') || el.parentElement === null) {\n                return true;\n            }\n            el = el.parentElement;\n        }\n    };\n    // in some browsers, the context menu event can be fired before the click event, which means\n    // the context menu event could open the popup, but then the click event closes it straight away.\n    PopupService.prototype.isEventSameChainAsOriginalEvent = function (originalClick, mouseEvent, touchEvent) {\n        // we check the coordinates of the event, to see if it's the same event. there is a 1 / 1000 chance that\n        // the event is a different event, however that is an edge case that is not very relevant (the user clicking\n        // twice on the same location isn't a normal path).\n        // event could be mouse event or touch event.\n        var mouseEventOrTouch = null;\n        if (mouseEvent) {\n            // mouse event can be used direction, it has coordinates\n            mouseEventOrTouch = mouseEvent;\n        }\n        else if (touchEvent) {\n            // touch event doesn't have coordinates, need it's touch object\n            mouseEventOrTouch = touchEvent.touches[0];\n        }\n        if (mouseEventOrTouch && originalClick) {\n            // for x, allow 4px margin, to cover iPads, where touch (which opens menu) is followed\n            // by browser click (when you life finger up, touch is interrupted as click in browser)\n            var screenX_1 = mouseEvent ? mouseEvent.screenX : 0;\n            var screenY_1 = mouseEvent ? mouseEvent.screenY : 0;\n            var xMatch = Math.abs(originalClick.screenX - screenX_1) < 5;\n            var yMatch = Math.abs(originalClick.screenY - screenY_1) < 5;\n            if (xMatch && yMatch) {\n                return true;\n            }\n        }\n        return false;\n    };\n    PopupService.prototype.getWrapper = function (ePopup) {\n        while (!utils_1._.containsClass(ePopup, 'ag-popup') && ePopup.parentElement) {\n            ePopup = ePopup.parentElement;\n        }\n        return utils_1._.containsClass(ePopup, 'ag-popup') ? ePopup : null;\n    };\n    PopupService.prototype.setAlwaysOnTop = function (ePopup, alwaysOnTop) {\n        var eWrapper = this.getWrapper(ePopup);\n        if (!eWrapper) {\n            return;\n        }\n        utils_1._.addOrRemoveCssClass(eWrapper, 'ag-always-on-top', !!alwaysOnTop);\n        if (alwaysOnTop) {\n            this.bringPopupToFront(eWrapper);\n        }\n    };\n    PopupService.prototype.bringPopupToFront = function (ePopup) {\n        var parent = this.getPopupParent();\n        var popupList = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup'));\n        var popupLen = popupList.length;\n        var alwaysOnTopList = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup.ag-always-on-top'));\n        var onTopLength = alwaysOnTopList.length;\n        var eWrapper = this.getWrapper(ePopup);\n        if (!eWrapper || popupLen <= 1 || !parent.contains(ePopup)) {\n            return;\n        }\n        var pos = popupList.indexOf(eWrapper);\n        if (onTopLength) {\n            var isPopupAlwaysOnTop = utils_1._.containsClass(eWrapper, 'ag-always-on-top');\n            if (isPopupAlwaysOnTop) {\n                if (pos !== popupLen - 1) {\n                    utils_1._.last(alwaysOnTopList).insertAdjacentElement('afterend', eWrapper);\n                }\n            }\n            else if (pos !== popupLen - onTopLength - 1) {\n                alwaysOnTopList[0].insertAdjacentElement('beforebegin', eWrapper);\n            }\n        }\n        else if (pos !== popupLen - 1) {\n            utils_1._.last(popupList).insertAdjacentElement('afterend', eWrapper);\n        }\n        var params = {\n            type: 'popupToFront',\n            api: this.gridOptionsWrapper.getApi(),\n            columnApi: this.gridOptionsWrapper.getColumnApi(),\n            eWrapper: eWrapper\n        };\n        this.eventService.dispatchEvent(params);\n    };\n    __decorate([\n        context_1.Autowired('gridOptionsWrapper'),\n        __metadata(\"design:type\", gridOptionsWrapper_1.GridOptionsWrapper)\n    ], PopupService.prototype, \"gridOptionsWrapper\", void 0);\n    __decorate([\n        context_1.Autowired('environment'),\n        __metadata(\"design:type\", environment_1.Environment)\n    ], PopupService.prototype, \"environment\", void 0);\n    __decorate([\n        context_1.Autowired('eventService'),\n        __metadata(\"design:type\", eventService_1.EventService)\n    ], PopupService.prototype, \"eventService\", void 0);\n    PopupService = __decorate([\n        context_1.Bean('popupService')\n    ], PopupService);\n    return PopupService;\n}());\nexports.PopupService = PopupService;\n"]},"metadata":{},"sourceType":"script"}